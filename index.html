<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WHG Fugen – Verbrauchsrechner</title>

  <!-- iOS Vollbild / Theme -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#0f172a">

  <style>
    :root {
      --bg:#f7f7fb; --card:#fff; --text:#0f172a; --muted:#6b7280;
      --border:#e5e7eb; --focus:#6366f1; --ring:rgba(99,102,241,.25); --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans";
         background:var(--bg);color:var(--text);line-height:1.4}
    .container{max-width:980px;margin:0 auto;padding:32px 20px}
    h1{font-size:28px;margin:0 0 6px}
    .subtitle{color:var(--muted);font-size:14px;margin-bottom:20px}

    .nav{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--border);background:#fff;border-radius:10px;
         padding:10px 14px;font-weight:600;cursor:pointer}
    .btn:focus{outline:none;border-color:var(--focus);box-shadow:0 0 0 4px var(--ring)}
    .link{display:inline-block;text-decoration:none;color:inherit}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
          box-shadow:0 1px 2px rgba(0,0,0,.03)}
    .card + .card{margin-top:16px}
    .card-header{padding:16px 18px;border-bottom:1px solid var(--border);font-weight:600}
    .card-body{padding:16px 18px}

    .grid{display:grid;gap:16px}
    @media (min-width:700px){
      .grid-cols-2{grid-template-columns:1fr 1fr}
      .grid-cols-3{grid-template-columns:repeat(3,1fr)}
    }

    label{display:block;font-size:14px;font-weight:600;margin-bottom:6px}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    input[type="text"],select{
      width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);background:#fff;font-size:16px;
      outline:none;transition:border-color .15s ease, box-shadow .15s ease
    }
    input:focus,select:focus{border-color:var(--focus);box-shadow:0 0 0 4px var(--ring)}

    .tile{border:1px solid var(--border);border-radius:16px;padding:14px;background:#fff}
    .tile .label{font-size:13px;color:var(--muted)}
    .tile .value{margin-top:4px;font-size:24px;font-weight:700;letter-spacing:.2px}
    .unit{font-weight:500;color:var(--muted);font-size:14px}
    .fine{font-size:12px;color:var(--muted)}
    .hide{display:none}
  </style>
</head>
<body>
  <main class="container">
    <header>
      <h1>WHG Fugen – Verbrauchsrechner</h1>
      <p class="subtitle">Start → Eingaben · Unterseiten rechnen Mischungen & Gewichte.</p>
    </header>

    <!-- Navigation -->
    <nav class="nav">
      <a class="btn link" href="#start">Start</a>
      <a class="btn link" href="#dichtstoff">Dichtstoff</a>
      <a class="btn link" href="#primer">Primer</a>
    </nav>

    <!-- ===== Seiten ===== -->
    <section id="page-start" data-page="start" class="page">
      <section class="card">
        <div class="card-header">Eingaben</div>
        <div class="card-body grid grid-cols-2">
          <div>
            <label for="width">Fugenbreite (mm)</label>
            <input id="width" type="text" inputmode="decimal" placeholder="z. B. 20" />
            <div class="hint">Annahme: Fugentiefe = Fugenbreite.</div>
          </div>
          <div>
            <label for="length">Gesamtmeter der Fugen (m)</label>
            <input id="length" type="text" inputmode="decimal" placeholder="z. B. 150" />
          </div>
          <div>
            <label for="pkgSealant">Gebindegröße Dichtstoff</label>
            <select id="pkgSealant">
              <option value="2.5">2,5 L</option>
              <option value="4">4 L</option>
              <option value="10" selected>10 L</option>
              <option value="25">25 L</option>
            </select>
          </div>
          <div>
            <label>Primer</label>
            <div class="hint">Gebindegröße fest: 1 l · Verbrauch: 0,04 l/m</div>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="card-header">Zusammenfassung – Gebinde & Reste</div>
        <div class="card-body grid grid-cols-2">
          <div class="tile">
            <div class="label">Dichtstoff – Gesamt</div>
            <div class="value"><span id="s_total">–</span> <span class="unit">l</span></div>
            <div class="fine">A/B Verhältnis 10:1 (Volumen)</div>
          </div>
          <div class="tile">
            <div class="label">Primer – Gesamt (0,04 l/m)</div>
            <div class="value"><span id="p_total">–</span> <span class="unit">l</span></div>
          </div>
        </div>
        <div class="card-body grid grid-cols-2">
          <div class="tile">
            <div class="label">Dichtstoff – volle Gebinde</div>
            <div class="value"><span id="s_pkgs">–</span> <span class="unit">stk</span></div>
            <div class="fine">Rest: <span id="s_rest">–</span> <span class="unit">l</span></div>
          </div>
          <div class="tile">
            <div class="label">Primer – volle Gebinde (1 l)</div>
            <div class="value"><span id="p_pkgs">–</span> <span class="unit">stk</span></div>
            <div class="fine">Rest: <span id="p_rest">–</span> <span class="unit">l</span></div>
          </div>
        </div>
        <div class="card-body">
          <a class="btn link" href="#dichtstoff">→ Zur Dichtstoff-Mischung</a>
          <a class="btn link" href="#primer" style="margin-left:8px">→ Zur Primer-Mischung</a>
        </div>
      </section>
    </section>

    <!-- Unterseite Dichtstoff -->
    <section id="page-dichtstoff" data-page="dichtstoff" class="page hide">
      <section class="card">
        <div class="card-header">Dichtstoff – Verbrauch & Gebinde</div>
        <div class="card-body grid grid-cols-3">
          <div class="tile">
            <div class="label">Gesamt</div>
            <div class="value"><span id="sd_total">–</span> <span class="unit">l</span></div>
          </div>
          <div class="tile">
            <div class="label">Volle Gebinde</div>
            <div class="value"><span id="sd_pkgs">–</span> <span class="unit">stk</span></div>
          </div>
          <div class="tile">
            <div class="label">Rest</div>
            <div class="value"><span id="sd_rest">–</span> <span class="unit">l</span></div>
          </div>
        </div>
        <div class="card-body grid grid-cols-2">
          <div class="tile">
            <div class="label">Rest Anteile (Volumen)</div>
            <div class="value">A: <span id="sd_restA_l">–</span> <span class="unit">l</span> · B: <span id="sd_restB_l">–</span> <span class="unit">l</span></div>
          </div>
          <div class="tile">
            <div class="label">Rest Gewichte</div>
            <div class="value">A: <span id="sd_restA_kg">–</span> <span class="unit">kg</span> · B: <span id="sd_restB_kg">–</span> <span class="unit">kg</span></div>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="card-header">Eingewogene Masse A → benötigte B (Volumen-Verhältnis 10:1)</div>
        <div class="card-body grid grid-cols-3">
          <div>
            <label for="sd_Ag">Komponente A (g)</label>
            <input id="sd_Ag" type="text" inputmode="decimal" placeholder="z. B. 1200" />
            <div class="hint">Gegeneinheit wird angezeigt.</div>
          </div>
          <div class="tile">
            <div class="label">A entspricht</div>
            <div class="value"><span id="sd_A_l">–</span> <span class="unit">l</span></div>
          </div>
          <div class="tile">
            <div class="label">Benötigt B</div>
            <div class="value"><span id="sd_B_g">–</span> <span class="unit">g</span></div>
            <div class="fine">entspricht <span id="sd_B_l">–</span> <span class="unit">l</span></div>
          </div>
        </div>
      </section>

      <div class="card" style="margin-top:16px">
        <div class="card-body"><a class="btn link" href="#start">← Zurück zur Startseite</a></div>
      </div>
    </section>

    <!-- Unterseite Primer -->
    <section id="page-primer" data-page="primer" class="page hide">
      <section class="card">
        <div class="card-header">Primer – Bedarf & Gebinde</div>
        <div class="card-body grid grid-cols-3">
          <div class="tile">
            <div class="label">Gesamt (0,04 l/m)</div>
            <div class="value"><span id="pp_total">–</span> <span class="unit">l</span></div>
          </div>
          <div class="tile">
            <div class="label">Volle Gebinde (1 l)</div>
            <div class="value"><span id="pp_pkgs">–</span> <span class="unit">stk</span></div>
          </div>
          <div class="tile">
            <div class="label">Rest</div>
            <div class="value"><span id="pp_rest">–</span> <span class="unit">l</span></div>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="card-header">Primer-Typ & Anmischung (Verhältnis nach Gewicht)</div>
        <div class="card-body grid grid-cols-2">
          <div>
            <label for="primerType">Primer-Typ</label>
            <select id="primerType">
              <option value="CP-P" selected>CP-P (4:1)</option>
              <option value="CP-S">CP-S (1:1)</option>
              <option value="CP-A">CP-A (7:4)</option>
            </select>
            <div class="hint">Verhältnis A:B nach Gewicht</div>
          </div>
          <div>
            <label for="pp_Ag">Eingewogene Masse A (g)</label>
            <input id="pp_Ag" type="text" inputmode="decimal" placeholder="z. B. 120" />
            <div class="hint">Gegeneinheit (l) wird angezeigt</div>
          </div>
        </div>
        <div class="card-body grid grid-cols-3">
          <div class="tile">
            <div class="label">A entspricht</div>
            <div class="value"><span id="pp_A_l">–</span> <span class="unit">l</span></div>
          </div>
          <div class="tile">
            <div class="label">Benötigt B (g)</div>
            <div class="value"><span id="pp_B_g">–</span> <span class="unit">g</span></div>
            <div class="fine">entspricht <span id="pp_B_l">–</span> <span class="unit">l</span></div>
          </div>
          <div class="tile">
            <div class="label">Mischungsverhältnis</div>
            <div class="value"><span id="pp_ratio">–</span></div>
          </div>
        </div>
      </section>

      <div class="card" style="margin-top:16px">
        <div class="card-body"><a class="btn link" href="#start">← Zurück zur Startseite</a></div>
      </div>
    </section>
  </main>

  <script>
    /* Konstanten */
    const RATIO_A = 10/11, RATIO_B = 1/11;          // Dichtstoff Volumenverhältnis
    const DENS_A = 1.6, DENS_B = 1.72;              // kg/l Dichtstoff
    const PRIMER_CONS_PER_M = 0.04;                 // l pro m
    const PRIMER_PKG = 1;                           // l

    const PRIMERS = {
      "CP-P": { partsA:4, partsB:1, densA:0.96,  densB:0.92  }, // kg/l
      "CP-S": { partsA:1, partsB:1, densA:0.956, densB:0.811 },
      "CP-A": { partsA:7, partsB:4, densA:1.13,  densB:1.03  }
    };

    /* Helpers */
    const $ = s => document.querySelector(s);
    const nf = n => {
      if (!Number.isFinite(n)) return '–';
      try { return new Intl.NumberFormat('de-DE',{minimumFractionDigits:2,maximumFractionDigits:2}).format(n); }
      catch { return (Math.round(n*100)/100).toFixed(2); }
    };
    const parseLocale = str => {
      if (!str) return NaN;
      const normalized = String(str).replace(/\s/g,'').replace(/\./g,'').replace(/,/g,'.');
      const n = Number(normalized);
      return Number.isFinite(n) ? n : NaN;
    };

    /* Eingaben (Start) */
    const widthEl = $('#width');
    const lengthEl = $('#length');
    const pkgSealantEl = $('#pkgSealant');

    /* Start-Ausgaben */
    const s_total = $('#s_total'),   p_total = $('#p_total');
    const s_pkgs  = $('#s_pkgs'),    p_pkgs  = $('#p_pkgs');
    const s_rest  = $('#s_rest'),    p_rest  = $('#p_rest');

    /* Dichtstoff Unterseite */
    const sd_total = $('#sd_total'), sd_pkgs = $('#sd_pkgs'), sd_rest = $('#sd_rest');
    const sd_restA_l = $('#sd_restA_l'), sd_restB_l = $('#sd_restB_l');
    const sd_restA_kg = $('#sd_restA_kg'), sd_restB_kg = $('#sd_restB_kg');
    const sd_Ag = $('#sd_Ag'), sd_A_l = $('#sd_A_l'), sd_B_g = $('#sd_B_g'), sd_B_l = $('#sd_B_l');

    /* Primer Unterseite */
    const pp_total = $('#pp_total'), pp_pkgs = $('#pp_pkgs'), pp_rest = $('#pp_rest');
    const primerTypeEl = $('#primerType'), pp_Ag = $('#pp_Ag'), pp_A_l = $('#pp_A_l'), pp_B_g = $('#pp_B_g'), pp_B_l = $('#pp_B_l'), pp_ratio = $('#pp_ratio');

    /* Kernberechnungen (gemeinsam) */
    function computeSealantBase(){
      const w = parseLocale(widthEl.value);
      const L = parseLocale(lengthEl.value);
      const pkg = parseFloat(pkgSealantEl.value || '10');
      if (!(w>0) || !(L>0)) return {total:NaN, pkgs:NaN, rest:NaN};
      const total = (w*w*L)/1000;                 // l
      const pkgs  = Math.floor(total / pkg);
      const rest  = total - pkgs*pkg;
      return {total, pkgs, rest, pkg};
    }
    function computePrimerBase(){
      const L = parseLocale(lengthEl.value);
      if (!(L>0)) return {total:NaN, pkgs:NaN, rest:NaN};
      const total = L * PRIMER_CONS_PER_M;        // l
      const pkgs  = Math.floor(total / PRIMER_PKG);
      const rest  = total - pkgs*PRIMER_PKG;
      return {total, pkgs, rest};
    }

    /* Startseite aktualisieren */
    function renderStart(){
      const s = computeSealantBase();
      const p = computePrimerBase();
      s_total.textContent = nf(s.total);
      s_pkgs.textContent  = Number.isFinite(s.pkgs) ? s.pkgs : '–';
      s_rest.textContent  = nf(s.rest);
      p_total.textContent = nf(p.total);
      p_pkgs.textContent  = Number.isFinite(p.pkgs) ? p.pkgs : '–';
      p_rest.textContent  = nf(p.rest);
    }

    /* Dichtstoff Unterseite */
    function renderSealantPage(){
      const s = computeSealantBase();
      sd_total.textContent = nf(s.total);
      sd_pkgs.textContent  = Number.isFinite(s.pkgs) ? s.pkgs : '–';
      sd_rest.textContent  = nf(s.rest);

      const rA_l = s.rest * RATIO_A, rB_l = s.rest * RATIO_B;
      const rA_kg = rA_l * DENS_A,   rB_kg = rB_l * DENS_B;
      sd_restA_l.textContent = nf(rA_l); sd_restB_l.textContent = nf(rB_l);
      sd_restA_kg.textContent = nf(rA_kg); sd_restB_kg.textContent = nf(rB_kg);

      // Eingewogene Masse A → benötigte Masse B (10:1 nach Volumen)
      const Ag = parseLocale(sd_Ag.value);
      if (Ag>0){
        const A_l = Ag/1000 / DENS_A;                 // g → kg → l
        const B_l = A_l * (1/10);                     // 10:1 Volumen
        const Bg  = B_l * DENS_B * 1000;              // l → kg → g
        sd_A_l.textContent = nf(A_l);
        sd_B_l.textContent = nf(B_l);
        sd_B_g.textContent = nf(Bg);
      } else {
        sd_A_l.textContent = sd_B_l.textContent = sd_B_g.textContent = '–';
      }
    }

    /* Primer Unterseite */
    function renderPrimerPage(){
      const base = computePrimerBase();
      pp_total.textContent = nf(base.total);
      pp_pkgs.textContent  = Number.isFinite(base.pkgs) ? base.pkgs : '–';
      pp_rest.textContent  = nf(base.rest);

      const type = primerTypeEl.value;
      const p = PRIMERS[type];
      pp_ratio.textContent = `A ${p.partsA} : ${p.partsB} B (Gewicht)`;

      const Ag = parseLocale(pp_Ag.value);
      if (Ag>0){
        const A_l = Ag/1000 / p.densA;
        const Bg  = Ag * (p.partsB/p.partsA);         // Verhältnis nach Gewicht
        const B_l = Bg/1000 / p.densB;
        pp_A_l.textContent = nf(A_l);
        pp_B_g.textContent = nf(Bg);
        pp_B_l.textContent = nf(B_l);
      } else {
        pp_A_l.textContent = pp_B_g.textContent = pp_B_l.textContent = '–';
      }
    }

    /* Routing */
    function show(page){
      document.querySelectorAll('.page').forEach(s=>s.classList.add('hide'));
      const el = document.querySelector(`#page-${page}`) || document.querySelector('#page-start');
      el.classList.remove('hide');
      // Bei jedem Seitenwechsel neu rendern
      renderStart(); renderSealantPage(); renderPrimerPage();
    }
    function onHash(){ const hash = location.hash.replace('#','') || 'start'; show(hash); }
    window.addEventListener('hashchange', onHash);

    /* Events */
    ['input','change'].forEach(evt=>{
      widthEl.addEventListener(evt, ()=>{renderStart();renderSealantPage();});
      lengthEl.addEventListener(evt, ()=>{renderStart();renderSealantPage();renderPrimerPage();});
      pkgSealantEl.addEventListener(evt, ()=>{renderStart();renderSealantPage();});
      sd_Ag.addEventListener(evt, renderSealantPage);
      primerTypeEl.addEventListener(evt, renderPrimerPage);
      pp_Ag.addEventListener(evt, renderPrimerPage);
    });

    /* Defaults + Initial */
    widthEl.value = '20';
    lengthEl.value = '150';
    onHash();
  </script>
</body>
</html>
